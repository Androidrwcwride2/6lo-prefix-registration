<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629-xhtml.ent">


<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc authorship="yes"?>
<?rfc tocappendix="yes"?>
<rfc  xmlns:xi="http://www.w3.org/2001/XInclude" category="std" ipr="trust200902"
tocInclude="true" indexInclude="true" obsoletes=""  consensus="true"
submissionType="IETF" xml:lang="en" version="3"  updates="4861, 6550, 6553, 8505, 9010"
docName="draft-thubert-6lo-prefix-registration-01" >

<front>

   <title abbrev="Prefix Registration">IPv6 Neighbor Discovery Prefix Registration</title>
   <author initials="P" surname="Thubert" fullname="Pascal Thubert" role="editor">
      <organization abbrev="Cisco Systems">Cisco Systems, Inc</organization>
      <address>
         <postal>
            <street>Building D</street>
            <street>45 Allee des Ormes - BP1200 </street>
            <city>Mougins - Sophia Antipolis</city>
            <code>06254</code>
          <country>France</country>
         </postal>
         <phone>+33 497 23 26 34</phone>
         <email>pthubert@cisco.com</email>
      </address>
   </author>
   <area>Internet</area>

   <workgroup>6lo</workgroup>

   <abstract>
   <t>
    This document updates RFC 8505 to enable a node that owns or is directly
    connected to a prefix to register that prefix to neighbor routers. The
    registration indicates that the registered prefix can be reached via the
    advertising node without a loop.
    The prefix registration also provides a protocol-independant interface for
    the node to request neighbor router(s) to redistribute the prefix to
    the larger routing domain using their specific routing protocols.
    As an example, this document extends RFC 9010 to enable the 6LR to inject
    the registered prefix in RPL.
   </t>
   </abstract>
</front>

<middle>

<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->
<section anchor="introduction"> <name>Introduction</name>

<t>The design of Low Power and Lossy Networks (LLNs) is generally focused on
   saving energy, which is the most constrained resource of all. Other design
   constraints, such as a limited memory capacity, duty cycling of the LLN
   devices and low-power lossy transmissions, derive from that primary concern.
   The radio (both transmitting or simply listening) is a major energy drain
   and the LLN protocols must be adapted to allow the nodes to remain sleeping
   with the radio turned off at most times.
</t><t>
   The <xref target="RFC6550">"Routing Protocol for Low Power
   and Lossy Networks"</xref> (RPL) provides IPv6 <xref target="RFC8200"/>
   routing services within such constraints.
   To save signaling and routing state in constrained networks, the RPL routing
   is only performed along a Destination-Oriented Directed Acyclic Graph (DODAG)
   that is optimized to reach a Root node, as opposed to along the shortest path
   between 2 peers, whatever that would mean in each LLN.
</t><t>
   This trades the quality of peer-to-peer (P2P) paths for a vastly reduced
   amount of control traffic and routing state that would be required to
   operate an any-to-any shortest path protocol. Additionally,
   broken routes may be fixed lazily and on-demand, based on dataplane
   inconsistency discovery, which avoids wasting energy in the proactive repair
   of unused paths.
</t><t>
   The classical "IPv6 Neighbor Discovery (IPv6 ND) Protocol"
   <xref target="RFC4861"/> <xref target="RFC4862"/> was defined for serial
   links and shared transit media such as Ethernet at a time when broadcast
   was cheap on those media while memory for neighbor cache was expensive.
   It was thus designed as a reactive protocol that relies on caching and
   multicast operations for the Address Discovery (aka Lookup) and Duplicate Address Detection (DAD) of IPv6 unicast addresses.
   Those multicast operations typically impact every node on-link when at most
   one is really targeted, which is a waste of energy, and imply that all
   nodes are awake to hear the request, which is inconsistent with power
   saving (sleeping) modes.
</t><t>
   The original 6LoWPAN ND, <xref target="RFC6775"> "Neighbor Discovery
   Optimizations for 6LoWPAN networks"</xref>, was introduced to avoid the
   excessive use of multicast messages and enable IPv6 ND for operations over
   energy-constrained nodes.
   <xref target="RFC6775"/> changes the classical IPv6 ND model to proactively
   establish the Neighbor Cache Entry (NCE) associated to the unicast address of
   a 6LoWPAN Node (6LN) in the a 6LoWPAN Router(s) (6LR) that serves it.
   To that effect, <xref target="RFC6775"/> defines a new Address Registration
   Option (ARO) that is  placed in unicast Neighbor Solicitation (NS) and
   Neighbor Advertisement (NA) messages between the 6LN and the 6LR.
</t><t>
   <xref target="RFC8505"> "Registration Extensions for 6LoWPAN Neighbor
   Discovery"</xref> updates <xref target="RFC6775"/> into a generic Address
   Registration mechanism that can be used to access services such as routing
   and ND proxy and introduces the Extended Address Registration Option (EARO)
   for that purpose. This provides a routing-agnostic interface for a host to
   request that the router injects a unicast IPv6 address in the local routing
   protocol and provide return reachability for that address.
</t><t>
   <xref target="I-D.ietf-6lo-multicast-registration">
   "IPv6 Neighbor Discovery Multicast Address Listener Subscription"</xref>
   updates <xref target="RFC8505"/> to enable a listener to subscribe an IPv6
    anycast or multicast address; the draft also extends <xref target="RFC9010"/>
    to enable the 6LR to inject the anycast and multicast addresses in RPL.
    Similarly, this specification extends <xref target="RFC8505"/> and
    <xref target="RFC9010"/> to add the capability for the 6LN to register
    prefixes as opposed to addresses, and to signal in a protocol-independant
    fashion to the 6LR that it is expected to redistribute the prefixes in
    their specific routing protocols.
</t>


</section>	<!-- end section = "Introduction"  -->



<section> <name>Terminology</name>
  <section anchor="bcp"><name>Requirements Language</name>
  <t>

    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
    "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
    "OPTIONAL" in this document are to be interpreted as described in BCP 14
    <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when,
    they appear in all capitals, as shown here.

  </t>

<t>
  In addition, the terms "Extends" and "Amends" are used as per
  <xref target="I-D.kuehlewind-update-tag" /> section 3.
</t>
  </section>	<!-- end section "Requirements Language" -->

  <section anchor="lo"><name>References</name>
    <t>
	This document uses terms and concepts that are discussed in:
    </t>
	<ul>
	<li> <xref target="RFC4861">"Neighbor Discovery for IP version 6"
		</xref> and
	    <xref target="RFC4862">"IPv6 Stateless address Autoconfiguration"
		</xref>,
    </li>
	<li> <xref target="RFC6775">Neighbor Discovery Optimization for Low-Power
		and Lossy Networks</xref>, as well as
    </li>
    <li>
	    <xref target="RFC8505">
		"Registration Extensions for 6LoWPAN Neighbor Discovery"</xref> and
	</li>
    <li>
	    <xref target="RFC9008">
		"Using RPI Option Type, Routing Header for Source Routes,
        and IPv6-in-IPv6 Encapsulation in the RPL Data Plane"</xref>.
	</li>
	</ul>
  </section> <!--	 end section "References" -->



  <section anchor="acronyms"><name>Glossary</name>
    <t> This document uses the following acronyms:</t>
       <dl newline="false" indent="7" spacing="compact" >
       <dt>6BBR</dt><dd> 6LoWPAN Backbone Router </dd>
       <dt>6BBR</dt><dd> 6LoWPAN Border Router </dd>
       <dt>6LN</dt><dd> 6LoWPAN Node </dd>
       <dt>6LR</dt><dd> 6LoWPAN Router </dd>
       <dt>6CIO</dt><dd> Capability Indication Option </dd>
       <dt>AMC</dt><dd> Address Mapping Confirmation </dd>
       <dt>AMR</dt><dd> Address Mapping Request</dd>
       <dt>ARO</dt><dd> Address Registration Option</dd>
       <dt>DAC</dt><dd> Duplicate Address Confirmation </dd>
       <dt>DAD</dt><dd> Duplicate Address Detection </dd>
       <dt>DAR</dt><dd> Duplicate Address Request</dd>
       <dt>EARO</dt><dd> Extended Address Registration Option</dd>
       <dt>EDAC</dt><dd> Extended Duplicate Address Confirmation  </dd>
       <dt>EDAR</dt><dd> Extended Duplicate Address Request</dd>
       <dt>DODAG</dt><dd> Destination-Oriented Directed Acyclic Graph </dd>
       <dt>IR</dt><dd> Ingress Replication </dd>
       <dt>LLN</dt><dd> Low-Power and Lossy Network </dd>
       <dt>NA</dt><dd>  Neighbor Advertisement </dd>
       <dt>NCE</dt><dd>  Neighbor Cache Entry  </dd>
       <dt>ND</dt><dd>  Neighbor Discovery  </dd>
       <dt>NS</dt><dd>  Neighbor Solicitation  </dd>
       <dt>ROVR</dt><dd> Registration Ownership Verifier </dd>
       <dt>RTO</dt><dd> RPL Target Option </dd>
       <dt>RA</dt><dd>  Router Advertisement  </dd>
       <dt>RS</dt><dd>  Router Solicitation  </dd>
       <dt>TID</dt><dd> Transaction ID </dd>
       <dt>TIO</dt><dd> Transit Information Option </dd>
       </dl>


  </section>	<!-- end section "Glossary" -->


  <section anchor="terms"><name>New terms</name>

    <t> This document introduces the following terms:</t>

       <dl newline="false" indent="7" spacing="compact" >

       <dt>Origin</dt><dd> The node that issued the prefix
       advertisement, either in the form of a NS(EARO) or as a DAO(TIO, RTO) </dd>
       <dt>Merge/merging</dt><dd> The action of receiving multiple anycast or
       multicast advertisements, either internally from self, in the form of
       a NS(EARO), or as a DAO(TIO, RTO), and generating a single DAO(TIO, RTO).
       The 6RPL router maintains a state per origin for each advertised address, and merges the advertisements for all subsriptions for the same
       address in a single advertisement.
       A RPL router that merges becomes the origin of the merged advertisement
       and uses its own values for the Path Sequence and ROVR fields.
       </dd>

       </dl>


  </section> <!--	 end section "New terms" -->

</section>	<!-- end section "Terminology" -->



<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->
<!-- **************************************************************** -->

<section anchor="overview"><name>Overview</name>
   <t>
   This specification inherits from <xref target="RFC6550"/>,
   <xref target="RFC8505"/>, and <xref target="RFC9010"/> to register prefixes as opposed to addresses. Unless specified otherwise therein,
   the behavior of the 6LBR that acts as RPL Root, of the intermediate routers
   down the RPL graph, of the 6LR that act as access routers and of the 6LNs
   that are the RPL-unaware destinations, is the same as for unicast addresses.
   In particular, forwarding a packet happens as specified in section 11 of
   <xref target="RFC6550"/>, including loop avoidance and detection, though in
   the case of multicast multiple copies might be generated.
   </t>
   <t><xref target="RFC8505"/> is a pre-requisite to this specification.
   A node that implements this MUST also implement <xref target="RFC8505"/>.
   This specification does not introduce a new option; it modifies
   existing options and updates the associated behaviors to enable the
   Registration for Multicast Addresses as an extension to
   <xref target="RFC8505"/>.
   </t>
   <t>
   This specification also extends <xref target="RFC6550"/> and
   <xref target="RFC9010"/> in the case of a route-over multilink subnet based
   on the RPL routing protocol, to add multicast ingress replication in
   Non-Storing Mode and anycast support in both Storing and Non-Storing modes.
   A 6LR that implements the RPL extensions specified therein MUST also
   implement <xref target="RFC9010"/>.
   </t>
    <t>
    <xref target="figref"/> illustrates the classical situation of an LLN as a
    single IPv6 Subnet, with a 6LoWPAN Border Router (6LBR) that acts as Root
    for RPL operations and maintains a registry of the active registrations as
    an abstract data structure called an Address Registrar for 6LoWPAN ND.
    </t>

    <t>
	The LLN may be a hub-and-spoke access link such	as (Low-Power) Wi-Fi
    <xref target="IEEE80211"/> and Bluetooth (Low Energy)
    <xref target="IEEE802151"/>, or a Route-Over LLN such as the Wi-SUN and 6TiSCH meshes
    <xref target="I-D.heile-lpwan-wisun-overview"/> that leverages 6LoWPAN
    <xref target="RFC4919"/><xref target="RFC6282"/>
    and RPL <xref target="RFC6550"/> over <xref target="IEEE802154"/>.
    </t>

    <figure anchor="figref" align="center"><name>Wireless Mesh</name>
    <artwork><![CDATA[
                  |
      ----+-------+------------
          |     Wire side
       +------+
       | 6LBR |
       |(Root)|
       +------+
       o  o  o  Wireless side
   o   o o   o  o o
  o  o  o o   o  o  o
 o  o  o   LLN  o   +---+
   o  o   o  o   o  |6LR|
   o o  o o   o     +---+
    o   o   o o o  o    z
   o  o oo o  o        +---+
          o            |6LN|
                       +---+
    ]]></artwork></figure>


<t>
   A leaf acting as a 6LN registers its unicast, multicast, and anycast
   addresses a RPL router acting as a 6LR, using a layer-2 unicast NS message
   with an EARO as specified in <xref target="RFC8505"/> and <xref target=
   "I-D.ietf-6lo-multicast-registration"/>.
   The registration state is periodically renewed by the Registering Node,
   before the lifetime indicated in the EARO expires. As for unicast IPv6
   addresses, the 6LR uses an EDAR/EDAC exchange with the 6LBR to notify the
   6LBR of the presence of the listeners.
</t><t>
   This specification updates the EARO with one new flag, the P flag for
   Prefix,  as detailed in <xref target="R8505E"/>.
   The existing R flag that requests reachability for the registered address
   gets new behavior.
   With this extension the 6LNs can now attract the traffic for a full prefix, using the new P flag in the EARO to signal that the
   registration is for a prefix. Multiple 6LN may register
   the same prefix to the same 6LR or to different 6LRs.
</t><t>
   If the R flag is set in the subscription of one or more 6LNs for the same
   address, the 6LR is requested to redistributes the prefix in other routing
   protocol (e.g., RPL), based on the longest subscription lifetime across the
   active subscriptions for the prefix.
</t><t>
   It is possible to leverage this specification between the 6LN and the
   6LR for the registration of prefixes in networks that are not necessarily
   LLNs, and/or where the routing protocol between the 6LR and above is not
   necessarily RPL.
</t>

</section> <!-- end section "Overview" -->


   <section anchor="tgt4861"><name>Updating RFC 4861</name>
   <t>
   <xref target="RFC4861"/> expects that the NS/NA exchange is for a unicast
   address, which is indicated in the Target Address field of the ND message.
   This specification Amends <xref target="RFC4861"/> by allowing to advertise a
   prefix in the Target Address field when the NS or NA message is used for a
   registration, per section 5.5 of <xref target="RFC8505"/>; in that case, the
   prefix length is indicated in the EARO of the NS message, overloading the
   field that is used in the NA response for the Status.
    </t>
    </section ><!-- Updating RFC 4861 -->
    <section anchor="CIO"><name>Extending RFC 7400</name>

    <t>
   This specification Extends <xref target="RFC7400"> "6LoWPAN-GHC: Generic
   Header Compression for IPv6 over Low-Power Wireless Personal Area Networks
   (6LoWPANs)"</xref> by defining a new capability bit for use in the
   6CIO.  <xref target="RFC7400"/> was already extended by <xref target="RFC8505"/> for use in IPv6 ND messages.
    </t>
    <t>
   The new "Registration for prefixes Supported" (F) flag indicates
   to the 6LN that the 6LR accepts IPv6 prefix
   registrations as specified in this document and will ensure that packets
   for the addresses that match this prefix will be routed to the 6LNs that
   registered the prefix, and the route to the prefix will be redistributed if
   the R flag is set to 1.
    </t>
    <t>
   <xref target="fig6CIO"/> illustrates the X flag in its suggested position
   (8, counting 0 to 15 in network order in the 16-bit array), to be confirmed by IANA.
   </t>
   <figure anchor="fig6CIO"><name>New Capability Bits in the 6CIO</name>
   <artwork>
    <![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |   Length = 1  |   Reserved  |F|X|A|D|L|B|P|E|G|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Reserved                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ]]></artwork>
    </figure>

    <t> New Option Field:    </t>
	<dl>
	<dt>X</dt><dd> 1-bit flag: "Registration for Unicast, Multicast, and Anycast
    Addresses Supported" </dd>
	</dl>

    </section>	<!-- end section "Extending RFC 7400" -->




<section anchor="coex"><name>Updating RFC 6550</name>
<t>
   <xref target="RFC6550"/> uses the Path Sequence in the Transit Information
   Option (TIO) to retain only the freshest unicast route and remove stale ones,
   e.g., in the case of mobility. <xref target="RFC9010"/> copies the TID from
   the EARO into the Path Sequence, and the ROVR field into the associated RPL
   Target Option (RTO).
   This way, it is possible to identify both the registering node and the
   order of registration in RPL for each individual advertisement, so the
   most recent path and lifetime values are used.
</t><t>

   <xref target="I-D.ietf-6lo-multicast-registration"/> requires the use of the
   ROVR field as the indication of the origin of a Target advertisement in the
   RPL DAO messages, as specified in section 6.1 of <xref target="RFC9010"/>.
   For anycast and multicast advertisements (in NS or DAO messages), multiple
   origins may subscribe to the same address, in which case the multiple
   advertisements from the different or unknown origins are merged by the common
   parent; in that case, the common parent becomes the origin of the merged
   advertisements and uses its own ROVR value. On the other hand, a parent that
   propagates an advertisement from a single origin uses the original ROVR in
   the propagated RTO, as it does for unicast address advertisements, so the
   origin is recognised across multiple hops.

</t><t>
   This specification Extends <xref target="RFC6550"/> to require that,
   for prefix routes, the Path Sequence is used between and only between
   advertisements for the same Target and from the same origin (i.e, with the same ROVR value); in that case, only the freshest advertisement is retained. But the freshness comparison cannot apply if the
   origin is not determined (i.e., the origin did not support this specification).
</t><t>
   <xref target="RFC6550"/> uses the Path Lifetime in the TIO to indicate the
   remaining time for which the advertisement is valid for unicast route
   determination, and a Path Lifetime value of 0 invalidates that route.
   <xref target="RFC9010"/> maps the Address Registration lifetime in the EARO
   and the Path Lifetime in the TIO so they are comparable when both forms of
   advertisements are received.
</t><t>
   The RPL router that merges multiple advertisement for the same prefix must
   use and advertise the longest remaining lifetime
   across all the origins of the advertisements for that prefix.
   When the lifetime expires, the router sends a no-path DAO (i.e. the lifetime
   is 0) using the same value for ROVR value as for the previous advertisements,
   that is either self or the single descendant that advertised the Target.
</t><t>

   Note that the Registration Lifetime, TID and ROVR fields are also placed in
   the EDAR message so the state created by EDAR is also comparable with that created upon an NS(EARO) or a DAO message. For simplicity the text below
   mentions only NS(EARO) but applies also to EDAR.
</t>


</section>	<!-- end section "Updating RFC 6550" -->

<section anchor="updating"><name>Updating RFC 8505</name>





<section anchor="R8505E"><name>New EARO flag</name>

<t>
   Section 4.1 of <xref target="RFC8505"/> defines the EARO as an extension to
   the ARO option defined in <xref target="RFC6775"/>.

</t>
<t>
   This specification adds
   a new P flag to the EARO flags field to signal that the Registered Address is
   a prefix. The A (signaling an anycast address), M (signaling a multicast address), and P (signaling a prefix) flags are mutually exclusive.
   </t>
<t>
   <xref target="EARO"/> illustrates the P flags in its suggested positions
   (1 counting 0 to 7 in network order in the 8-bit array), to be confirmed by
   IANA.
</t>
 <figure anchor="EARO"><name>EARO Option Format</name>
 <artwork align="center">
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |     Type      |     Length    |  plen/Status  |    Opaque     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |V|P|A|M| I |R|T|     TID       |     Registration Lifetime     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
 ...             Registration Ownership Verifier                 ...
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
 </figure><!-- end figure "EARO Option Format" -->

    <t> New and updated Option Fields:    </t>
    <dl>
    <dt>plen/Status</dt><dd> 8-bit field: This field contains a prefix Length if
    the P flag is set in and the EARO is placed in an NS message. The field
    contains a Status if the EARO is placed in an NA message regardless of the
    setting of the P flag. </dd>
    <dt>V</dt><dd> 1-bit field: reserved, MUST be set to 0 and ignored by the
    receiver</dd>
    <dt>P</dt><dd> 1-bit flag: "Registration for an IPv6 Prefix". When the
    P flag is set to 1, the registration is for the prefix indicated in the NS
    Target using the prefix length signaled in the plen/Status field.</dd>
    </dl>

</section> <!-- end section "New EARO flag" -->

<section anchor="R8505D"><name>New EDAR Message Flag field</name>

<t>
   Section 4 of <xref target="RFC6775"/> provides the same format for DAR and
   DAC messages but the status field is only used in DAC message and has to
   set to zero in DAC messages. <xref target="RFC8505"/> extends the DAC message
   as an EDAC but does not change the status field in the EDAR.

</t>
<t>
   This specification repurposes the status field in the EDAR and a Flags field.
   It adds a new P flag  to signal that a "Registration for an IPv6 Prefix".
   As for EARO, the A, M, and P flags are mutually exclusive.
</t>
<t>
   <xref target="EDAR"/> illustrates the A and M flags in their suggested
   positions (0 and 1, respectively, counting 0 to 7 in network order in the
   8-bit array), to be confirmed by IANA.
</t>
 <figure anchor="EDAR"><name>Extended Duplicate Address Message Format</name>
 <artwork align="center">
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |     Type      |CodePfx|CodeSfx|          Checksum             |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |A|M|P|Reserved |     TID       |     Registration Lifetime     |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
...            Registration Ownership Verifier (ROVR)           ...
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 +    if (p==1)  First 96 bits of the prefix                     +
 |    else       Registered Address                              |
 +                                                               +
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |    if (P==1)          reserved                |    plen       |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
 </figure><!-- end figure "EDAR Message Format" -->

    <t> New and updated Option Fields:    </t>
	<dl>
	<dt>Reserved</dt><dd> 6-bit field: reserved, MUST be set to 0 and ignored by the receiver</dd>
	<dt>A</dt><dd> 1-bit flag: "Registration for Anycast Address" </dd>
	<dt>M</dt><dd> 1-bit flag: "Registration for Multicast Address" </dd>
	</dl>

</section> <!-- end section "New EARO flag" -->



<section anchor="multireg"><name>Registering Extensions</name>
<t>
   With <xref target="RFC8505"/>:
   </t>
<ul>
   <li>
   A router that expects to reboot may send a final RA message, upon which
   nodes should subscribe elsewhere or redo the subscription to the same router
   upon reboot.
   In all other cases, a node reboot is silent.
   When the node comes back to life, existing registration
   state might be lost if it was not persisted, e.g., in persistent memory.
   </li>
   <li>
   Only unicast addresses can be registered.
   </li>
   <li>
   The 6LN must register all its ULA and GUA with a NS(EARO).
   </li>
   <li>
   The 6LN may set the R flag in the EARO to obtain return reachability services by the 6LR, e.g., through ND proxy operations, or by injecting the route in a route-over subnet.
   </li>
   <li>
   the 6LR maintains a registration state per Registered Address, including an
   NCE with the Link Layer Address (LLA) of the Registered Node (the 6LN here).
   </li>
   </ul>

  <t>
   This specification adds the following behavior, similar to that introduced
   by <xref target="I-D.ietf-6lo-multicast-registration"/> for multicast addresses:
  </t>
   <ul>
   <li>
   The operation for registering prefixes is similar as for addresses from the
   perspective of the 6LN, but show important differences on the router side,
   which maintains a separate state for each origin and merges them in its own
   advertisements.
   </li>
   <li>
   <t>
   The ARO Status indicating a "Registration Refresh Request" applies to prefixes
   as well.
   </t>
   <t>
   This status is used in asynchronous NA(EARO) messages to indicate to peer 6LNs
   that they are requested to reregister all addresses and prefixes that were
   previously registered to the originating node. The NA message may be sent to
   a unicast or a multicast link-scope address and should be contained within
   the L2 range where nodes may effectively have registered/subscribed to this
   router, e.g., a radio broadcast domain.
   </t>
   <t>
   A device that wishes to refresh its state, e.g., upon reboot if it may have
   lost some registration state, SHOULD send an asynchronous NA(EARO) with this
   new status value. That asynchronous NA(ARO) SHOULD be sent to the all-nodes
   link scope multicast address (FF02::1) and Target MUST be set to the link
   local address that was exposed previously by this node to accept registrations,
   and the TID MUST be set to 0.
   </t>
   <t>
   In an unreliable environment, the multicast NA(EARO) message may be resent in
   a fast sequence, in which case the TID must be incremented each time.
   A 6LN that has recently
   processed the NA(ARO) ignores the NA(EARO) with a newer TID received
   within the duration of the fast sequence. That duration depends on the
   environent and has to be configured. By default, it is of 10 seconds.
   </t>
   </li>
   <li>
   Registration for prefixes is now supported. A new flag is added to the EARO
   to signal when the registration is for a prefix as opposed to an address.
   </li>
   <li>
   The Status field in the EDAR message that was repurposed to transport the flags to signal multicast and anycast is extended to transport the prefix
   registration as well. The checks at the 6LBR for Duplicate Address Detection
   now need to incorporate validation of the right to register, which might be
   allowed in a range and provided that the prefix does not overlap with another
   existing registration.
   </li>
   <li>
   If the 6LB acts as a router to prefixes or owns the prefixes entirely, it
   SHOULD register all those prefixes on all interface from which it might be needed to relay traffic to that prefix, and it MUST set the P flag in the
   EARO for those prefixes.
   </li>
   <li>
   The 6LN MAY set the R flag in the EARO to request the 6LR to redistribute
   the prefix on other links using a routing protocol. The 6LR MUST NOT
   reregister that prefix to yet another router as it may create a loop.
   </li>
   <li>
   The 6LR and the 6LBR are extended to accept more than one registration for
   the same prefix, since multiple 6LNs may register it. The Registration
   Ownership Verifier (ROVR) in the EARO identifies uniquely a registration
   within the namespace of the Registered Prefix.
   </li>
   <li>
    The 6LR MUST maintain a registration state per tuple (IPv6 prefix, ROVR)
    for all registered prefix. It SHOULD notify the 6LBR
    with an EDAR message, unless it determined that the 6LBR is legacy and does
    not support this specification. In turn, the 6LBR MUST maintain a
    registration state per tuple (IPv6 prefix, ROVR) for all prefixes.
   </li>

   </ul>

</section> <!-- end section "Registering Extensions"-->

</section> <!-- end section "Updating RFC 8505"-->


<section anchor="updating2"><name>Updating RFC 9010</name>
<t>
   With <xref target="RFC9010"/>:
   </t>
   <ul>
   <li>
   The 6LR injects only unicast routes in RPL
   </li>
   <li>
   Upon a registration with the R flag set to 1 in the EARO, the 6LR injects the address in the RPL unicast support.
   </li><li>
   Upon receiving a packet directed to a unicast address for which it has an
   active registration, the 6LR delivers the packet as a unicast layer-2 frame
   to the LLA the nodes that registered the unicast address.
   </li>
   </ul>
   <t>
   This specification adds the following behavior:
   </t>
   <ul>
   <li>
   Upon a registration with the R and the P flags set to 1 in the EARO,
   then the 6LR injects the prefix in RPL multicast support using a prefix RTO.
   </li><li>
   Upon receiving a packet directed to an address that derives from a prefix for
   which it has at least one registration, the 6LR delivers a copy of the packet
   as a unicastlayer-2 frame to the LLA of exactly one of the nodes that
   registered to that prefix, using the longest match derivation to find the
   best 6LN.
   </li>
   </ul>


</section> <!-- end section "Updating RFC 9010"-->


<section  anchor="sec8928"><name>Leveraging RFC 8928</name>
<t>
    <xref target="RFC8928"> Address-Protected Neighbor Discovery for
    Low-Power and Lossy Networks </xref> was defined to protect the ownership of unicast IPv6 addresses that are registered with
    <xref target="RFC8505"/>.

</t>
<t>
    With <xref target="RFC8928"/>, it is possible for a node to autoconfigure a
    pair of public and private keys and use them to sign the registration of
    addresses that are either autoconfigured or obtained through other methods.

</t>
<t>
    The first hop router (the 6LR) may then validate a registration and
    perform source address validation on packets coming from the sender node
    (the 6LN).

</t>
<t>
    Prefixes are not always owned by one node. Multiple nodes
    may register the same prefix.
    In that context, the method specified in <xref target="RFC8928"/> cannot be used with autoconfigured keypairs to protect a single ownership.
</t>
<t>
    For a prefix, as for an anycast or a multicast address, it is still possible
    to leverage <xref target="RFC8928"/> to enforce the right to register.
    If <xref target="RFC8928"/> is used, a keypair MUST
    be associated with the prefix before it is deployed, and a ROVR MUST be
    generated from that keypair as specified in <xref target="RFC8928"/>.
    The prefix and the ROVR MUST then be installed in the 6LBR so it can
    recognize the prefix and compare the ROVR on the first registration to
    validate the right to register.
</t>
<t>
    The keypair MUST then be provisioned in each node that needs to
    subscribe to the prefix or a prefix within, so the node can follow the
    steps in <xref target="RFC8928"/> to register the prefix.
</t>
</section>  <!-- Leveraging RFC 8929 -->



<section  anchor="sec"><name>Security Considerations</name>
<t>
    This specification extends <xref target="RFC8505"/>, and
    the security section of that document also applies to this document.
    In particular, the link layer SHOULD be sufficiently
    protected to prevent rogue access.
</t>
<t>
   <xref target="sec8928"/> leverages <xref target="RFC8928"/> to prevent an
   rogue node to register a unicast address that it does not own.
   The mechanism could be extended to anycast and multicast addresses if the
   values of the ROVR they use is known in advance, but how this is done is
   not in scope for this specification.
   One way would be to authorize in a advance the ROVR of the valid users.
   A less preferred way could be to synchronize the ROVR and TID values across
   the valid subscribers as a preshared key material.
</t>
<t>
   In the latter case, it could be possible to update the keys associated to
   a prefix in all the 6LNs, but the flow is not clearly documented and may
   not complete in due time for all nodes in LLN use cases. It may be simpler
   to install a all-new address with new keys over a period of time, and
   switch the traffic to that address when the migration is complete.
</t>
</section>	<!-- end section "Security Considerations" -->

<section anchor="back"><name>Backward Compatibility</name>
<t>
   A legacy 6LN will not register prefixess and the service will be
   the same when the network is upgraded. A legacy 6LR will not set the F flag
   in the 6CIO and an upgraded 6LN will not subscribe multicast addresses.
</t>
<t>
   Upon an EDAR message, a legacy 6LBR may not realize that the address being
   registered is anycast or multicast, and return that it is duplicate in the
   EDAC status. The 6LR MUST ignore a duplicate status in the EDAR for anycast
   and multicast addresses.
</t>

</section>	<!-- end section "Backward Compatibility" -->

<section ><name>IANA Considerations</name>
<t>
    Note to RFC Editor, to be removed: please replace "This RFC" throughout this
    document by the RFC number for this specification once it is allocated.
    Also, the I Field is defined in <xref target="RFC9010"/> but is missing from
    the registry, so the bit positions must be added for completeness.
</t>
<t>
    IANA is requested to make changes under the "Internet Control Message
    Protocol version 6 (ICMPv6) Parameters" <xref target="IANA.ICMP"/> and the
    "Routing Protocol for Low Power and Lossy Networks (RPL)" <xref target="IANA.RPL"/>
    registry groupings, as follows:
</t>

    <section><name>New EDAR Message Flags Registry</name>
	<t>
    IANA is requested to make changes under the "EDAR Message Flags" registry grouping under the
    heading "Internet Control Message Protocol version 6 (ICMPv6) Parameters"
    as indicated in <xref target="EDARflags"/>:
	</t>

	<table anchor="EDARflags" ><name>EDAR Message flag</name>
   <thead>
      <tr><td>Bit Number</td><td>Meaning</td><td>Reference</td></tr>
   </thead><tbody>
      <tr><td>2 (suggested)</td><td>P flag: Registration for an IPv6 Prefix</td><td>This RFC</td></tr>
      <tr><td>2..7</td><td>Unassigned </td><td></td></tr>
   </tbody>
	</table>	<!-- end table "EDAR Message flags" +-->
    </section>	<!-- end section "New EDAR Message flags Registry -->


 <section><name>New EARO flags</name>
	<t> IANA is requested to make additions to the "Address Registration Option
    Flags" <xref target="IANA.ICMP.ARO.FLG"/> registry under the heading
    "Internet Control Message Protocol version 6 (ICMPv6) Parameters" as
    indicated in <xref target="AROflags"/>:
	</t>

	<table anchor="AROflags" ><name>New ARO flag</name>
   <thead>
      <tr><td>ARO flag</td><td>Meaning</td><td>Reference</td></tr>
   </thead><tbody>
      <tr><td>1 (suggested)</td><td>P flag: Registration for an IPv6 Prefix</td><td>This RFC</td></tr>

      <tr><td>4 and 5</td><td>"I" Field</td><td>RFC 8505</td></tr>
   </tbody>
	</table>	<!-- end table "New  ARO flag" +-->
    </section>	<!-- end section "New ARO flag -->






    <section title="New 6LoWPAN Capability Bit">
	<t>
    IANA is requested to make an addition to the
    "6LoWPAN Capability Bits" <xref target="IANA.ICMP.6CIO"/> registry under the
    heading "Internet Control Message Protocol version 6 (ICMPv6) Parameters"
    as indicated in <xref target="CIOdat"/>:
	</t>

	<table anchor="CIOdat" ><name>New 6LoWPAN Capability Bits</name>
   <thead>
      <tr><td>Capability Bit</td><td>Meaning</td><td>Reference</td></tr>
   </thead><tbody>
      <tr><td>7 (suggested)</td><td>F flag: Registration for prefixes Supported (F)</td><td>This RFC</td></tr>

   </tbody>
	</table>	<!-- end table "New 6LoWPAN Capability Bits" -->
    </section>	<!-- end section "New 6LoWPAN Capability Bits" -->




</section>	<!-- end section "IANA Considerations" -->

<section title="Acknowledgments">
<t>

</t>
</section> <!-- title="Acknowledgments" -->







</middle>

<back>


    <references title="Normative References">
	<!-- RFC  -->

	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4861.xml"/>
	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4862.xml"/>
	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6550.xml"/>
	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6775.xml"/>
	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7400.xml"/>
	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8200.xml"/>
	<xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8505.xml"/>

    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8928.xml"/>

    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.9010.xml"/>

	   <reference anchor="IANA.ICMP">
		<front>
			<title>IANA Registry for ICMPv6</title>
			<author>
				<organization>
					IANA
				</organization>
			</author>
			<date year=""></date>
		</front>
		<seriesInfo name="IANA," value="https://www.iana.org/assignments/icmpv6-parameters/icmpv6-parameters.xhtml"></seriesInfo>
	   </reference>

       <reference anchor="IANA.ICMP.ARO.FLG">
       <front>
			<title>IANA Sub-Registry for the ARO Flags</title>
			<author>
				<organization>
					IANA
				</organization>
			</author>
			<date year=""></date>
		</front>
		<seriesInfo name="IANA," value="https://www.iana.org/assignments/icmpv6-parameters/icmpv6-parameters.xhtml#icmpv6-adress-registration-option-flags"></seriesInfo>
	   </reference>

       <reference anchor="IANA.ICMP.6CIO">
       <front>
			<title>IANA Sub-Registry for the 6LoWPAN Capability Bits</title>
			<author>
				<organization>
					IANA
				</organization>
			</author>
			<date year=""></date>
		</front>
		<seriesInfo name="IANA," value="https://www.iana.org/assignments/icmpv6-parameters/icmpv6-parameters.xhtml#sixlowpan-capability-bits"></seriesInfo>
	   </reference>


	   <reference  anchor="IANA.RPL">
       <front>
			<title>IANA Registry for the RPL</title>
			<author>
				<organization>
					IANA
				</organization>
			</author>
			<date year=""></date>
		</front>
		<seriesInfo name="IANA," value="https://www.iana.org/assignments/rpl/rpl.xhtml"></seriesInfo>
	   </reference>




    </references>


    <references title="Informative References">
	<!-- RFC  -->

    <!-- I-D -->

    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4919.xml"/>
    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6282.xml"/>
    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.9008.xml"/>


      <xi:include href='https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.kuehlewind-update-tag.xml'/>
    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.heile-lpwan-wisun-overview.xml"/>
    <xi:include href="https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-6lo-multicast-registration.xml"/>
      <reference anchor="IEEE802154">
         <front>
            <title>IEEE Std 802.15.4, Part. 15.4: Wireless Medium Access
            Control (MAC) and Physical Layer (PHY) Specifications for Low-Rate
            Wireless Personal Area Networks
            </title>
            <author>
               <organization>IEEE standard for Information Technology</organization>
            </author>
            <date/>
         </front>
      </reference>

      <reference anchor="IEEE80211"
                 target="https://ieeexplore.ieee.org/document/9363693" >
        <front>
          <title>
            IEEE Standard 802.11 - IEEE Standard for Information
            Technology - Telecommunications and information exchange
            between systems Local and metropolitan area networks -
            Specific requirements - Part 11: Wireless LAN Medium
            Access Control (MAC) and Physical Layer (PHY)
            Specifications.
          </title>
          <author>
               <organization>IEEE standard for Information Technology</organization>
           </author>
          <date/>
        </front>
      </reference>


      <reference anchor="IEEE802151">
         <front>
            <title> IEEE Standard for Information Technology -
		Telecommunications and Information Exchange Between Systems -
		Local and Metropolitan Area Networks - Specific Requirements. -
		Part 15.1: Wireless Medium Access Control (MAC) and Physical
		Layer (PHY) Specifications for Wireless Personal Area Networks
		(WPANs)
            </title>
            <author>
            	<organization> IEEE standard for Information Technology
		</organization>
            </author>
            <date/>
         </front>
      </reference>

    </references>

</back>

</rfc>
